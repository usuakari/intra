<!-- templates/parent_generic.html -->
{% extends "base.html" %}
{% block title %}{{ parent.name }} | 社内ポータル{% endblock %}

{% block left_menu %}
  {% include "includes/_left_menu_children.html" with parent=parent children=children only %}
{% endblock %}

{% block content %}
  <h1 class="h3 mb-3">{{ parent.name }} のコンテンツ</h1>

  {# 子カテゴリごとに見出し＋テーブルで束ねる例 #}
  {% for child, rows in contents_by_child.items %}
    <h2 id="child-{{ child.id }}" class="h5 mt-4 mb-2">
      {{ child.name }} 
    </h2>
    <button class="btn btn-primary" onclick="javascript:location.href='content/add/{{child.id}}'">追加</button>
    
    <div class="table-responsive">
      <table class="table table-sm table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th></th>
            <th>タイトル</th>
            <th>更新者ID</th>
            <th>更新日</th>
            <th>ファイル種別</th>
            <th>リンク</th>
          </tr>
        </thead>
        <tbody>
          {% for c in rows %}
            <tr>
              <td>
                <a class="btn btn-primary" href="{% url 'edit' content_id=c.id %}">編集</a>
              </td>
              <td class="fw-semibold">{{ c.title }}</td>
              <td>{{ c.updater_user_id }}</td>
              <td>{{ c.updated_at|date:"Y-m-d H:i" }}</td>
              <td>{{ c.file_type }}</td>
              <td>
                {% if c.file_url %}
                  <a class="btn btn-sm btn-outline-primary" href="{{ c.file_url }}" target="_blank" rel="noopener">開く</a>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-muted">コンテンツはありません</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% empty %}
    <div class="alert alert-secondary">配下コンテンツはありません。</div>
  {% endfor %}
{% endblock %}

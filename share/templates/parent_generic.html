<!-- templates/parent_generic.html -->
{% extends "base.html" %}
{% block title %}{{ parent.name }} | 社内ポータル{% endblock %}

{% block left_menu %}
  {% include "includes/_left_menu_children.html" with parent=parent children=children %}
{% endblock %}

{% block content %}
  <h1 class="h3 mb-3">{{ parent.name }} のコンテンツ</h1>

  {# 子カテゴリごとに見出し＋テーブルで束ねる例 #}
  {% for child, rows in contents_by_child.items %}
    <h2 id="child-{{ child.id }}" class="h5 mt-4 mb-2">
      {{ child.name }} 
      {% if user.is_authenticated %}
      <a class="btn btn-primary" href="{% url 'content_add' category_id=child.id %}">コンテンツ追加</a>
      {% endif %}
    </h2>
      
    <div class="table-responsive">
      <table class="table table-sm table-hover align-middle">
        <thead class="table-light">
          <tr>
            {% if user.is_authenticated %}
              <th>表示順</th>
              <th></th>
            {% endif %}
            <th>タイトル</th>
            <th>更新者ID</th>
            <th>更新日</th>
            <th>ファイル種別</th>
            <th>リンク</th>
            {% if user.is_authenticated %}
              <th></th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for c in rows %}
            <tr>
              {% if user.is_authenticated %}
              <td>
                {{ c.contents_display_order }}
              </td>
              <td>
                <a class="btn btn-primary" href="{% url 'edit' content_id=c.id %}">編集</a>
              </td>
              {% endif %}
              <td>
                <a class="fw-semibold" href="{% url 'content_view' content_id=c.id %}">{{ c.title }}</a>
              </td>
              <td>{{ c.updater_user_id }}</td>
              <td>{{ c.updated_at|date:"Y-m-d H:i" }}</td>
              <td>{{ c.file_type }}</td>
              <td>
                {% if c.file_url %}
                  <a class="btn btn-sm btn-outline-primary" href="{{ c.file_url }}" target="_blank" rel="noopener">開く</a>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
                {% if user.is_authenticated %}
                <td>
                <a class="btn btn-outline-danger" href="{% url 'content_delete' content_id=c.id %}">削除</a>
                </td>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-muted">コンテンツはありません</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% empty %}
    <div class="alert alert-secondary">配下コンテンツはありません。
    {% if user.is_authenticated %}
      <a class="btn btn-primary" href="{% url 'content_add_with_category' category_id=current_parent_id %}">コンテンツ追加はここをクリック</a>
    {% endif %}
    </div>
  {% endfor %}
{% endblock %}

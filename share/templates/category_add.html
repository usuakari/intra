{% extends "base.html" %}
{%  load static %}
{% block title %}タブ（親カテゴリ）・カテゴリ追加{% endblock %}


{% block content %}
<div class="container my-4">
    <h1 class="h4 mb-3">タブまたはカテゴリ追加</h1>

<form method="post" novalidate>
    {% csrf_token %}

    {{ form.non_field_errors }}


    <!--▼カテゴリの親ID設定（子カテゴリ）-->
    <!--<div class="form-label">※以下画像の「TOP・お知らせ」に相当するタブや、「あいさつ」に相当するカテゴリを追加します</div>
    <img src="{% static 'category_image.png' %}" alt="Category Image" class="img-fluid mb-3" style="max-width: 400px;">>-->

    <div class="mb-3">
        <label for="id_parent_category" class="form-label">追加したいものを選択</label>
        <div class="form-label">※タブを追加したい場合は「タブを追加する」のまま、既存のタブ内に配置する場合はタブ名を選択してください。</div>
            <select name="parent_id"  class="form-select" id="id_parent_id">
            <!--ブランク値なら親カテゴリIDを持たないのでタブ追加扱い-->
                <option value=""> タブを追加する </option>        
                {% for cat in top_categories %}
                    <option value="{{ cat.id }}"> {{cat.name}} </option> 
                {% endfor %}        
            </select>
        </div>

    <!--▼カテゴリの追加フォーム-->
    <label  for="id_name" name="new_category" id="id_name" class="form-label" >新しいタブ／カテゴリ名</label>
    {{ form.name }}
    <div class="text-danger small">{{ form.name.errors }}</div>
    <div class="mb-3">
    <!--▲カテゴリの追加フォーム-->

    <!--▼タブ表示順の設定-->
    <div class="mb-3">
        <label for="id_category_display_order_tabs" class="form-label">表示順（タブ）</label>
        {{ form.category_display_order_tabs }}
    </div>
    <!--▲タブ表示順の設定-->

    <!--▼左メニュー表示順の設定-->
    <div class="mb-3">
        <label for="id_category_display_order_leftmenues" class="form-label">表示順（左メニュー）</label>
        {{ form.category_display_order_leftmenues }}
    </div>
    <!--▲左メニュー表示順の設定-->




</div>

<button type="submit" class="btn btn-primary">登録する</button>

</form>
</div>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
    const parentSelect = document.getElementById('id_parent_id');
    const tabOrderField = document.querySelector('[for="id_category_display_order_tabs"]').closest('.mb-3');
    const leftMenuOrderField = document.querySelector('[for="id_category_display_order_leftmenues"]').closest('.mb-3');

    // フィールドの表示を切り替える関数
    function toggleFields() {
        if (parentSelect.value === "") {
            // 「タブを追加する」が選択されているとき
            tabOrderField.style.display = "block";
            leftMenuOrderField.style.display = "none";
        } else {
            // 既存のタブが選ばれているとき
            tabOrderField.style.display = "none";
            leftMenuOrderField.style.display = "block";
        }
    }

    // ページ読み込み時とセレクト変更時に実行
    toggleFields();
    parentSelect.addEventListener('change', toggleFields);
});
</script>

{% endblock %}